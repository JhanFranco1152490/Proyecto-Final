{% extends "layout.html" %}

{% block title %}
Profile
{% endblock %}{% block main %}

<div class="profile-wrapper">
    <div class="profile-card">

        <!-- Imagen izquierda -->
        <div class="profile-image-container">
            <div class="text-center">
                <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="profile-image">

                <!-- Nombre en morado -->
                <h4 class="mt-3" style="color: #b44bff; font-weight: 600;">
                    {{ user.username }}
                </h4>
            </div>
        </div>


        <!-- Información derecha -->
        <div class="profile-info">

            <h2 class="profile-title">My Profile</h2>

            <form action="/profile" method="post" id="profile-form">

                <!-- Read-only -->
                <div class="mb-3">
                    <label class="form-label">Username:</label>
                    <input class="form-control" value="{{ user.username }}" disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Role:</label>
                    <input class="form-control" value="{{ role_name }}" disabled>
                </div>

                <!-- Editable -->
                <div class="mb-3">
                    <label class="form-label">First Name:</label>
                    <input class="form-control editable-field" id="first_name" name="first_name"
                        value="{{ user.first_name }}" disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Last Name:</label>
                    <input class="form-control editable-field" id="last_name" name="last_name"
                        value="{{ user.last_name }}" disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Birthdate:</label>
                    <input class="form-control editable-field" id="birth_date" name="birth_date"
                        value="{{ user.birth_date }}" type="date" disabled>
                </div>

                <!-- Password -->
                <div id="password-section" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">New Password:</label>
                        <input name="password" type="password" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Confirm Password:</label>
                        <input name="confirmation" type="password" class="form-control">
                    </div>
                </div>

                <button id="btn-edit" class="btn btn-primary mt-3" type="button">Update Info</button>
                <button id="btn-save" class="btn btn-primary mt-3" type="submit" style="display: none;">
                    Save Changes
                </button>
                <button id="btn-cancel" class="btn btn-secondary mt-3" type="button" style="display:none; background-color: #dc3545; color: white; font-weight: bold;">
                    Cancel
                </button>
            </form>

        </div>
    </div>
</div>

<script>
    document.getElementById("btn-edit").addEventListener("click", () => {
        document.querySelectorAll(".editable-field").forEach(el => el.disabled = false);
        document.getElementById("password-section").style.display = "block";
        document.getElementById("btn-edit").style.display = "none";
        document.getElementById("btn-save").style.display = "block";
    });
    const originalValues = {
        first: "{{ user.first_name }}",
        last: "{{ user.last_name }}",
        birth: "{{ user.birth_date }}"
    };

    document.getElementById("btn-edit").addEventListener("click", () => {
        document.querySelectorAll(".editable-field").forEach(el => el.disabled = false);
        document.getElementById("password-section").style.display = "block";
        document.getElementById("btn-edit").style.display = "none";
        document.getElementById("btn-save").style.display = "block";
        document.getElementById("btn-cancel").style.display = "block";
    });

    document.getElementById("btn-cancel").addEventListener("click", () => {

        // Restaurar valores originales
        document.getElementById("first_name").value = originalValues.first;
        document.getElementById("last_name").value = originalValues.last;
        document.getElementById("birth_date").value = originalValues.birth;

        // Deshabilitar campos otra vez
        document.querySelectorAll(".editable-field").forEach(el => el.disabled = true);

        // Ocultar secciones de edición
        document.getElementById("password-section").style.display = "none";
        document.getElementById("btn-save").style.display = "none";
        document.getElementById("btn-cancel").style.display = "none";

        // Volver a mostrar botón Editar
        document.getElementById("btn-edit").style.display = "block";
    });
</script>

{% endblock %}